{"sessionId": "debug-session", "runId": "pre-fix", "hypothesisId": "A", "location": "nsfw_guard.py:174", "message": "_set_nsfw_tag entry", "data": {"path": "C:\\APPS\\Python\\PythonApps\\ComfyUI_windows_portable_nvidia\\ComfyUI_windows_portable\\ComfyUI\\output\\ComfyUI_temp_euoku_00001_.png", "is_nsfw": true, "score": 1.0, "label": "manual"}, "timestamp": 1765614664637}
{"sessionId": "debug-session", "runId": "pre-fix", "hypothesisId": "A", "location": "nsfw_guard.py:189", "message": "Image opened, checking format", "data": {"ext": ".png", "img_info_keys": ["prompt", "workflow"], "img_info_sample": {"prompt": "{\"1\": {\"inputs\": {\"ckpt_name\": \"juggernautXL_ragnarokBy.safetensors\"}, \"class_type\": \"CheckpointLoaderSimple\", \"_meta\": {\"title\": \"Load Checkpoint\"}}, \"2\": {\"inputs\": {\"seed\": 952922394507729, \"steps\": 30, \"cfg\": 3.0, \"sampler_name\": \"dpmpp_2m_sde\", \"scheduler\": \"karras\", \"denoise\": 1.0, \"model\": [\"1\", 0], \"positive\": [\"3\", 0], \"negative\": [\"20:3\", 0], \"latent_image\": [\"13\", 0]}, \"class_type\": \"KSampler\", \"_meta\": {\"title\": \"KSampler\"}}, \"3\": {\"inputs\": {\"text\": \"\\nA fine-art nude of a woman lying sideways on silk sheets, soft light across her back, her curves highlighted gently. Inspired by Helmut Newton and Petra Collins.\", \"clip\": [\"19\", 0]}, \"class_type\": \"CLIPTextEncode\", \"_meta\": {\"title\": \"CLIP Text Encode (Prompt)\"}}, \"8\": {\"inputs\": {\"images\": [\"17\", 0]}, \"class_type\": \"PreviewImage\", \"_meta\": {\"title\": \"Preview Image\"}}, \"13\": {\"inputs\": {\"width\": 832, \"height\": 1216, \"batch_size\": 1}, \"class_type\": \"EmptyLatentImage\", \"_meta\": {\"title\": \"Empty Latent Image\"}}, \"17\": {\"inputs\": {\"samples\": [\"2\", 0], \"vae\": [\"1\", 2]}, \"class_type\": \"VAEDecode\", \"_meta\": {\"title\": \"VAE Decode\"}}, \"19\": {\"inputs\": {\"stop_at_clip_layer\": -2, \"clip\": [\"1\", 1]}, \"class_type\": \"CLIPSetLastLayer\", \"_meta\": {\"title\": \"CLIP Set Last Layer\"}}, \"20:3\": {\"inputs\": {\"text\": \"Text, Watermark\", \"clip\": [\"1\", 1]}, \"class_type\": \"CLIPTextEncode\", \"_meta\": {\"title\": \"CLIP Text Encode (Prompt)\"}}}", "workflow": "{\"id\": \"7e642caf-e8ca-43fd-9832-19e15dc7f46f\", \"revision\": 0, \"last_node_id\": 20, \"last_link_id\": 56, \"nodes\": [{\"id\": 17, \"type\": \"VAEDecode\", \"pos\": [1310, 260], \"size\": [140, 46], \"flags\": {}, \"order\": 6, \"mode\": 0, \"inputs\": [{\"name\": \"samples\", \"type\": \"LATENT\", \"link\": 50}, {\"name\": \"vae\", \"type\": \"VAE\", \"link\": 45}], \"outputs\": [{\"name\": \"IMAGE\", \"type\": \"IMAGE\", \"links\": [43]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"VAEDecode\"}, \"widgets_values\": []}, {\"id\": 8, \"type\": \"PreviewImage\", \"pos\": [1760, -60], \"size\": [350, 390], \"flags\": {}, \"order\": 7, \"mode\": 0, \"inputs\": [{\"name\": \"images\", \"type\": \"IMAGE\", \"link\": 43}], \"outputs\": [], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"PreviewImage\"}, \"widgets_values\": []}, {\"id\": 19, \"type\": \"CLIPSetLastLayer\", \"pos\": [630, -170], \"size\": [270, 58], \"flags\": {}, \"order\": 2, \"mode\": 0, \"inputs\": [{\"name\": \"clip\", \"type\": \"CLIP\", \"link\": 52}], \"outputs\": [{\"name\": \"CLIP\", \"type\": \"CLIP\", \"links\": [54]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"CLIPSetLastLayer\"}, \"widgets_values\": [-2]}, {\"id\": 3, \"type\": \"CLIPTextEncode\", \"pos\": [980, -260], \"size\": [300, 120], \"flags\": {}, \"order\": 4, \"mode\": 0, \"inputs\": [{\"name\": \"clip\", \"type\": \"CLIP\", \"link\": 54}], \"outputs\": [{\"name\": \"CONDITIONING\", \"type\": \"CONDITIONING\", \"links\": [42]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"CLIPTextEncode\"}, \"widgets_values\": [\"\\nA fine-art nude of a woman lying sideways on silk sheets, soft light across her back, her curves highlighted gently. Inspired by Helmut Newton and Petra Collins.\"]}, {\"id\": 1, \"type\": \"CheckpointLoaderSimple\", \"pos\": [680, -20], \"size\": [270, 98], \"flags\": {}, \"order\": 0, \"mode\": 0, \"inputs\": [], \"outputs\": [{\"name\": \"MODEL\", \"type\": \"MODEL\", \"links\": [23]}, {\"name\": \"CLIP\", \"type\": \"CLIP\", \"links\": [52, 55]}, {\"name\": \"VAE\", \"type\": \"VAE\", \"links\": [45]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"CheckpointLoaderSimple\"}, \"widgets_values\": [\"juggernautXL_ragnarokBy.safetensors\"]}, {\"id\": 20, \"type\": \"3d8bbee1-9162-4cf9-9483-f8c9edc8656b\", \"pos\": [1010, -100], \"size\": [225, 134], \"flags\": {}, \"order\": 3, \"mode\": 0, \"inputs\": [{\"name\": \"clip\", \"type\": \"CLIP\", \"link\": 55}], \"outputs\": [{\"name\": \"CONDITIONING\", \"type\": \"CONDITIONING\", \"links\": [56]}], \"properties\": {\"proxyWidgets\": [[\"3\", \"text\"]], \"cnr_id\": \"comfy-core\", \"ver\": \"0.3.76\"}, \"widgets_values\": []}, {\"id\": 13, \"type\": \"EmptyLatentImage\", \"pos\": [840, 200], \"size\": [270, 106], \"flags\": {}, \"order\": 1, \"mode\": 0, \"inputs\": [], \"outputs\": [{\"name\": \"LATENT\", \"type\": \"LATENT\", \"links\": [48]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"EmptyLatentImage\"}, \"widgets_values\": [832, 1216, 1]}, {\"id\": 2, \"type\": \"KSampler\", \"pos\": [1420, -110], \"size\": [270, 262], \"flags\": {}, \"order\": 5, \"mode\": 0, \"inputs\": [{\"name\": \"model\", \"type\": \"MODEL\", \"link\": 23}, {\"name\": \"positive\", \"type\": \"CONDITIONING\", \"link\": 42}, {\"name\": \"negative\", \"type\": \"CONDITIONING\", \"link\": 56}, {\"name\": \"latent_image\", \"type\": \"LATENT\", \"link\": 48}], \"outputs\": [{\"name\": \"LATENT\", \"type\": \"LATENT\", \"links\": [50]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"KSampler\"}, \"widgets_values\": [952922394507729, \"randomize\", 30, 3, \"dpmpp_2m_sde\", \"karras\", 1]}], \"links\": [[23, 1, 0, 2, 0, \"MODEL\"], [42, 3, 0, 2, 1, \"CONDITIONING\"], [43, 17, 0, 8, 0, \"IMAGE\"], [45, 1, 2, 17, 1, \"VAE\"], [48, 13, 0, 2, 3, \"LATENT\"], [50, 2, 0, 17, 0, \"LATENT\"], [52, 1, 1, 19, 0, \"CLIP\"], [54, 19, 0, 3, 0, \"CLIP\"], [55, 1, 1, 20, 0, \"CLIP\"], [56, 20, 0, 2, 2, \"CONDITIONING\"]], \"groups\": [], \"definitions\": {\"subgraphs\": [{\"id\": \"3d8bbee1-9162-4cf9-9483-f8c9edc8656b\", \"version\": 1, \"state\": {\"lastGroupId\": 0, \"lastNodeId\": 38, \"lastLinkId\": 60, \"lastRerouteId\": 0}, \"revision\": 0, \"config\": {}, \"name\": \"Negative Prompts\", \"inputNode\": {\"id\": -10, \"bounding\": [-340, -127, 120, 60]}, \"outputNode\": {\"id\": -20, \"bounding\": [380, -127, 128.6640625, 60]}, \"inputs\": [{\"id\": \"2a003c94-ecef-4189-94e5-639b0a704c9d\", \"name\": \"clip\", \"type\": \"CLIP\", \"linkIds\": [60], \"localized_name\": \"clip\", \"pos\": [55, 20]}], \"outputs\": [{\"id\": \"e59786bc-94b7-486b-a377-bc3db8f8eefd\", \"name\": \"CONDITIONING\", \"type\": \"CONDITIONING\", \"linkIds\": [25], \"localized_name\": \"CONDITIONING\", \"pos\": [20, 20]}], \"widgets\": [], \"nodes\": [{\"id\": 3, \"type\": \"CLIPTextEncode\", \"pos\": [-160, -220], \"size\": [480, 276], \"flags\": {}, \"order\": 0, \"mode\": 0, \"inputs\": [{\"localized_name\": \"clip\", \"name\": \"clip\", \"type\": \"CLIP\", \"link\": 60}], \"outputs\": [{\"localized_name\": \"CONDITIONING\", \"name\": \"CONDITIONING\", \"type\": \"CONDITIONING\", \"links\": [25]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.75\", \"Node name for S&R\": \"CLIPTextEncode\"}, \"widgets_values\": [\"Text, Watermark\"]}], \"groups\": [], \"links\": [{\"id\": 60, \"origin_id\": -10, \"origin_slot\": 0, \"target_id\": 3, \"target_slot\": 0, \"type\": \"CLIP\"}, {\"id\": 25, \"origin_id\": 3, \"origin_slot\": 0, \"target_id\": -20, \"target_slot\": 0, \"type\": \"CONDITIONING\"}], \"extra\": {}}]}, \"config\": {}, \"extra\": {\"ds\": {\"scale\": 1.7715610000000017, \"offset\": [-953.444623183584, 135.70741308626853]}, \"frontendVersion\": \"1.32.10\"}, \"version\": 0.4}"}}, "timestamp": 1765614664638}
{"sessionId": "debug-session", "runId": "pre-fix", "hypothesisId": "A", "location": "nsfw_guard.py:197", "message": "PNG metadata preservation check", "data": {"preserved_keys": [], "skipped_keys": ["prompt", "workflow"], "total_keys": 2}, "timestamp": 1765614664639}
{"sessionId": "debug-session", "runId": "pre-fix", "hypothesisId": "B", "location": "nsfw_guard.py:207", "message": "PNG Windows fields before overwrite", "data": {"existing_keywords": null, "existing_subject": null, "existing_comment": null}, "timestamp": 1765614664640}
{"sessionId": "debug-session", "runId": "pre-fix", "hypothesisId": "A", "location": "nsfw_guard.py:220", "message": "PNG after save", "data": {"after_info_keys": ["UsgromanaNSFW", "UsgromanaNSFWScore", "UsgromanaNSFWLabel", "Keywords", "Subject", "Comment"]}, "timestamp": 1765614664907}
{"sessionId": "debug-session", "runId": "post-fix", "hypothesisId": "A", "location": "nsfw_guard.py:174", "message": "_set_nsfw_tag entry", "data": {"path": "C:\\APPS\\Python\\PythonApps\\ComfyUI_windows_portable_nvidia\\ComfyUI_windows_portable\\ComfyUI\\output\\ComfyUI_temp_koahg_00001_.png", "is_nsfw": true, "score": 1.0, "label": "manual"}, "timestamp": 1765614908167}
{"sessionId": "debug-session", "runId": "post-fix", "hypothesisId": "A", "location": "nsfw_guard.py:189", "message": "Image opened, checking format", "data": {"ext": ".png", "img_info_keys": ["prompt", "workflow"], "img_info_sample": {"prompt": "{\"1\": {\"inputs\": {\"ckpt_name\": \"juggernautXL_ragnarokBy.safetensors\"}, \"class_type\": \"CheckpointLoaderSimple\", \"_meta\": {\"title\": \"Load Checkpoint\"}}, \"2\": {\"inputs\": {\"seed\": 416947912840831, \"steps\": 30, \"cfg\": 3.0, \"sampler_name\": \"dpmpp_2m_sde\", \"scheduler\": \"karras\", \"denoise\": 1.0, \"model\": [\"1\", 0], \"positive\": [\"3\", 0], \"negative\": [\"20:3\", 0], \"latent_image\": [\"13\", 0]}, \"class_type\": \"KSampler\", \"_meta\": {\"title\": \"KSampler\"}}, \"3\": {\"inputs\": {\"text\": \"\\nA fine-art nude of a woman lying sideways on silk sheets, soft light across her back, her curves highlighted gently. Inspired by Helmut Newton and Petra Collins.\", \"clip\": [\"19\", 0]}, \"class_type\": \"CLIPTextEncode\", \"_meta\": {\"title\": \"CLIP Text Encode (Prompt)\"}}, \"8\": {\"inputs\": {\"images\": [\"17\", 0]}, \"class_type\": \"PreviewImage\", \"_meta\": {\"title\": \"Preview Image\"}}, \"13\": {\"inputs\": {\"width\": 832, \"height\": 1216, \"batch_size\": 1}, \"class_type\": \"EmptyLatentImage\", \"_meta\": {\"title\": \"Empty Latent Image\"}}, \"17\": {\"inputs\": {\"samples\": [\"2\", 0], \"vae\": [\"1\", 2]}, \"class_type\": \"VAEDecode\", \"_meta\": {\"title\": \"VAE Decode\"}}, \"19\": {\"inputs\": {\"stop_at_clip_layer\": -2, \"clip\": [\"1\", 1]}, \"class_type\": \"CLIPSetLastLayer\", \"_meta\": {\"title\": \"CLIP Set Last Layer\"}}, \"20:3\": {\"inputs\": {\"text\": \"Text, Watermark\", \"clip\": [\"1\", 1]}, \"class_type\": \"CLIPTextEncode\", \"_meta\": {\"title\": \"CLIP Text Encode (Prompt)\"}}}", "workflow": "{\"id\": \"7e642caf-e8ca-43fd-9832-19e15dc7f46f\", \"revision\": 0, \"last_node_id\": 20, \"last_link_id\": 56, \"nodes\": [{\"id\": 17, \"type\": \"VAEDecode\", \"pos\": [1310, 260], \"size\": [140, 46], \"flags\": {}, \"order\": 6, \"mode\": 0, \"inputs\": [{\"name\": \"samples\", \"type\": \"LATENT\", \"link\": 50}, {\"name\": \"vae\", \"type\": \"VAE\", \"link\": 45}], \"outputs\": [{\"name\": \"IMAGE\", \"type\": \"IMAGE\", \"links\": [43]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"VAEDecode\"}, \"widgets_values\": []}, {\"id\": 8, \"type\": \"PreviewImage\", \"pos\": [1760, -60], \"size\": [350, 390], \"flags\": {}, \"order\": 7, \"mode\": 0, \"inputs\": [{\"name\": \"images\", \"type\": \"IMAGE\", \"link\": 43}], \"outputs\": [], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"PreviewImage\"}, \"widgets_values\": []}, {\"id\": 19, \"type\": \"CLIPSetLastLayer\", \"pos\": [630, -170], \"size\": [270, 58], \"flags\": {}, \"order\": 2, \"mode\": 0, \"inputs\": [{\"name\": \"clip\", \"type\": \"CLIP\", \"link\": 52}], \"outputs\": [{\"name\": \"CLIP\", \"type\": \"CLIP\", \"links\": [54]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"CLIPSetLastLayer\"}, \"widgets_values\": [-2]}, {\"id\": 3, \"type\": \"CLIPTextEncode\", \"pos\": [980, -260], \"size\": [300, 120], \"flags\": {}, \"order\": 4, \"mode\": 0, \"inputs\": [{\"name\": \"clip\", \"type\": \"CLIP\", \"link\": 54}], \"outputs\": [{\"name\": \"CONDITIONING\", \"type\": \"CONDITIONING\", \"links\": [42]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"CLIPTextEncode\"}, \"widgets_values\": [\"\\nA fine-art nude of a woman lying sideways on silk sheets, soft light across her back, her curves highlighted gently. Inspired by Helmut Newton and Petra Collins.\"]}, {\"id\": 1, \"type\": \"CheckpointLoaderSimple\", \"pos\": [680, -20], \"size\": [270, 98], \"flags\": {}, \"order\": 0, \"mode\": 0, \"inputs\": [], \"outputs\": [{\"name\": \"MODEL\", \"type\": \"MODEL\", \"links\": [23]}, {\"name\": \"CLIP\", \"type\": \"CLIP\", \"links\": [52, 55]}, {\"name\": \"VAE\", \"type\": \"VAE\", \"links\": [45]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"CheckpointLoaderSimple\"}, \"widgets_values\": [\"juggernautXL_ragnarokBy.safetensors\"]}, {\"id\": 20, \"type\": \"3d8bbee1-9162-4cf9-9483-f8c9edc8656b\", \"pos\": [1010, -100], \"size\": [225, 134], \"flags\": {}, \"order\": 3, \"mode\": 0, \"inputs\": [{\"name\": \"clip\", \"type\": \"CLIP\", \"link\": 55}], \"outputs\": [{\"name\": \"CONDITIONING\", \"type\": \"CONDITIONING\", \"links\": [56]}], \"properties\": {\"proxyWidgets\": [[\"3\", \"text\"]], \"cnr_id\": \"comfy-core\", \"ver\": \"0.3.76\"}, \"widgets_values\": []}, {\"id\": 13, \"type\": \"EmptyLatentImage\", \"pos\": [840, 200], \"size\": [270, 106], \"flags\": {}, \"order\": 1, \"mode\": 0, \"inputs\": [], \"outputs\": [{\"name\": \"LATENT\", \"type\": \"LATENT\", \"links\": [48]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"EmptyLatentImage\"}, \"widgets_values\": [832, 1216, 1]}, {\"id\": 2, \"type\": \"KSampler\", \"pos\": [1420, -110], \"size\": [270, 262], \"flags\": {}, \"order\": 5, \"mode\": 0, \"inputs\": [{\"name\": \"model\", \"type\": \"MODEL\", \"link\": 23}, {\"name\": \"positive\", \"type\": \"CONDITIONING\", \"link\": 42}, {\"name\": \"negative\", \"type\": \"CONDITIONING\", \"link\": 56}, {\"name\": \"latent_image\", \"type\": \"LATENT\", \"link\": 48}], \"outputs\": [{\"name\": \"LATENT\", \"type\": \"LATENT\", \"links\": [50]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"KSampler\"}, \"widgets_values\": [416947912840831, \"randomize\", 30, 3, \"dpmpp_2m_sde\", \"karras\", 1]}], \"links\": [[23, 1, 0, 2, 0, \"MODEL\"], [42, 3, 0, 2, 1, \"CONDITIONING\"], [43, 17, 0, 8, 0, \"IMAGE\"], [45, 1, 2, 17, 1, \"VAE\"], [48, 13, 0, 2, 3, \"LATENT\"], [50, 2, 0, 17, 0, \"LATENT\"], [52, 1, 1, 19, 0, \"CLIP\"], [54, 19, 0, 3, 0, \"CLIP\"], [55, 1, 1, 20, 0, \"CLIP\"], [56, 20, 0, 2, 2, \"CONDITIONING\"]], \"groups\": [], \"definitions\": {\"subgraphs\": [{\"id\": \"3d8bbee1-9162-4cf9-9483-f8c9edc8656b\", \"version\": 1, \"state\": {\"lastGroupId\": 0, \"lastNodeId\": 38, \"lastLinkId\": 60, \"lastRerouteId\": 0}, \"revision\": 0, \"config\": {}, \"name\": \"Negative Prompts\", \"inputNode\": {\"id\": -10, \"bounding\": [-340, -127, 120, 60]}, \"outputNode\": {\"id\": -20, \"bounding\": [380, -127, 128.6640625, 60]}, \"inputs\": [{\"id\": \"2a003c94-ecef-4189-94e5-639b0a704c9d\", \"name\": \"clip\", \"type\": \"CLIP\", \"linkIds\": [60], \"localized_name\": \"clip\", \"pos\": [55, 20]}], \"outputs\": [{\"id\": \"e59786bc-94b7-486b-a377-bc3db8f8eefd\", \"name\": \"CONDITIONING\", \"type\": \"CONDITIONING\", \"linkIds\": [25], \"localized_name\": \"CONDITIONING\", \"pos\": [20, 20]}], \"widgets\": [], \"nodes\": [{\"id\": 3, \"type\": \"CLIPTextEncode\", \"pos\": [-160, -220], \"size\": [480, 276], \"flags\": {}, \"order\": 0, \"mode\": 0, \"inputs\": [{\"localized_name\": \"clip\", \"name\": \"clip\", \"type\": \"CLIP\", \"link\": 60}], \"outputs\": [{\"localized_name\": \"CONDITIONING\", \"name\": \"CONDITIONING\", \"type\": \"CONDITIONING\", \"links\": [25]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.75\", \"Node name for S&R\": \"CLIPTextEncode\"}, \"widgets_values\": [\"Text, Watermark\"]}], \"groups\": [], \"links\": [{\"id\": 60, \"origin_id\": -10, \"origin_slot\": 0, \"target_id\": 3, \"target_slot\": 0, \"type\": \"CLIP\"}, {\"id\": 25, \"origin_id\": 3, \"origin_slot\": 0, \"target_id\": -20, \"target_slot\": 0, \"type\": \"CONDITIONING\"}], \"extra\": {}}]}, \"config\": {}, \"extra\": {\"ds\": {\"scale\": 1.7715610000000017, \"offset\": [-953.444623183584, 135.70741308626853]}, \"frontendVersion\": \"1.32.10\"}, \"version\": 0.4}"}}, "timestamp": 1765614908169}
{"sessionId": "debug-session", "runId": "post-fix", "hypothesisId": "A", "location": "nsfw_guard.py:197", "message": "PNG metadata preservation check", "data": {"preserved_keys": ["prompt", "workflow"], "skipped_keys": [], "total_keys": 2}, "timestamp": 1765614908170}
{"sessionId": "debug-session", "runId": "post-fix", "hypothesisId": "B", "location": "nsfw_guard.py:207", "message": "PNG Windows fields before overwrite", "data": {"existing_keywords": null, "existing_subject": null, "existing_comment": null}, "timestamp": 1765614908172}
{"sessionId": "debug-session", "runId": "post-fix", "hypothesisId": "A", "location": "nsfw_guard.py:220", "message": "PNG after save", "data": {"after_info_keys": ["prompt", "workflow", "UsgromanaNSFW", "UsgromanaNSFWScore", "UsgromanaNSFWLabel", "Keywords", "Subject", "Comment"]}, "timestamp": 1765614908376}
{"sessionId": "debug-session", "runId": "post-fix", "hypothesisId": "A", "location": "nsfw_guard.py:174", "message": "_set_nsfw_tag entry", "data": {"path": "C:\\APPS\\Python\\PythonApps\\ComfyUI_windows_portable_nvidia\\ComfyUI_windows_portable\\ComfyUI\\output\\ComfyUI_temp_koahg_00001_.png", "is_nsfw": true, "score": 1.0, "label": "manual"}, "timestamp": 1765614965281}
{"sessionId": "debug-session", "runId": "post-fix", "hypothesisId": "A", "location": "nsfw_guard.py:189", "message": "Image opened, checking format", "data": {"ext": ".png", "img_info_keys": ["prompt", "workflow", "UsgromanaNSFW", "UsgromanaNSFWScore", "UsgromanaNSFWLabel", "Keywords", "Subject", "Comment", "Rating", "XML:com.adobe.xmp", "display_name"], "img_info_sample": {"prompt": "{\"1\": {\"inputs\": {\"ckpt_name\": \"juggernautXL_ragnarokBy.safetensors\"}, \"class_type\": \"CheckpointLoaderSimple\", \"_meta\": {\"title\": \"Load Checkpoint\"}}, \"2\": {\"inputs\": {\"seed\": 416947912840831, \"steps\": 30, \"cfg\": 3.0, \"sampler_name\": \"dpmpp_2m_sde\", \"scheduler\": \"karras\", \"denoise\": 1.0, \"model\": [\"1\", 0], \"positive\": [\"3\", 0], \"negative\": [\"20:3\", 0], \"latent_image\": [\"13\", 0]}, \"class_type\": \"KSampler\", \"_meta\": {\"title\": \"KSampler\"}}, \"3\": {\"inputs\": {\"text\": \"\\nA fine-art nude of a woman lying sideways on silk sheets, soft light across her back, her curves highlighted gently. Inspired by Helmut Newton and Petra Collins.\", \"clip\": [\"19\", 0]}, \"class_type\": \"CLIPTextEncode\", \"_meta\": {\"title\": \"CLIP Text Encode (Prompt)\"}}, \"8\": {\"inputs\": {\"images\": [\"17\", 0]}, \"class_type\": \"PreviewImage\", \"_meta\": {\"title\": \"Preview Image\"}}, \"13\": {\"inputs\": {\"width\": 832, \"height\": 1216, \"batch_size\": 1}, \"class_type\": \"EmptyLatentImage\", \"_meta\": {\"title\": \"Empty Latent Image\"}}, \"17\": {\"inputs\": {\"samples\": [\"2\", 0], \"vae\": [\"1\", 2]}, \"class_type\": \"VAEDecode\", \"_meta\": {\"title\": \"VAE Decode\"}}, \"19\": {\"inputs\": {\"stop_at_clip_layer\": -2, \"clip\": [\"1\", 1]}, \"class_type\": \"CLIPSetLastLayer\", \"_meta\": {\"title\": \"CLIP Set Last Layer\"}}, \"20:3\": {\"inputs\": {\"text\": \"Text, Watermark\", \"clip\": [\"1\", 1]}, \"class_type\": \"CLIPTextEncode\", \"_meta\": {\"title\": \"CLIP Text Encode (Prompt)\"}}}", "workflow": "{\"id\": \"7e642caf-e8ca-43fd-9832-19e15dc7f46f\", \"revision\": 0, \"last_node_id\": 20, \"last_link_id\": 56, \"nodes\": [{\"id\": 17, \"type\": \"VAEDecode\", \"pos\": [1310, 260], \"size\": [140, 46], \"flags\": {}, \"order\": 6, \"mode\": 0, \"inputs\": [{\"name\": \"samples\", \"type\": \"LATENT\", \"link\": 50}, {\"name\": \"vae\", \"type\": \"VAE\", \"link\": 45}], \"outputs\": [{\"name\": \"IMAGE\", \"type\": \"IMAGE\", \"links\": [43]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"VAEDecode\"}, \"widgets_values\": []}, {\"id\": 8, \"type\": \"PreviewImage\", \"pos\": [1760, -60], \"size\": [350, 390], \"flags\": {}, \"order\": 7, \"mode\": 0, \"inputs\": [{\"name\": \"images\", \"type\": \"IMAGE\", \"link\": 43}], \"outputs\": [], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"PreviewImage\"}, \"widgets_values\": []}, {\"id\": 19, \"type\": \"CLIPSetLastLayer\", \"pos\": [630, -170], \"size\": [270, 58], \"flags\": {}, \"order\": 2, \"mode\": 0, \"inputs\": [{\"name\": \"clip\", \"type\": \"CLIP\", \"link\": 52}], \"outputs\": [{\"name\": \"CLIP\", \"type\": \"CLIP\", \"links\": [54]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"CLIPSetLastLayer\"}, \"widgets_values\": [-2]}, {\"id\": 3, \"type\": \"CLIPTextEncode\", \"pos\": [980, -260], \"size\": [300, 120], \"flags\": {}, \"order\": 4, \"mode\": 0, \"inputs\": [{\"name\": \"clip\", \"type\": \"CLIP\", \"link\": 54}], \"outputs\": [{\"name\": \"CONDITIONING\", \"type\": \"CONDITIONING\", \"links\": [42]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"CLIPTextEncode\"}, \"widgets_values\": [\"\\nA fine-art nude of a woman lying sideways on silk sheets, soft light across her back, her curves highlighted gently. Inspired by Helmut Newton and Petra Collins.\"]}, {\"id\": 1, \"type\": \"CheckpointLoaderSimple\", \"pos\": [680, -20], \"size\": [270, 98], \"flags\": {}, \"order\": 0, \"mode\": 0, \"inputs\": [], \"outputs\": [{\"name\": \"MODEL\", \"type\": \"MODEL\", \"links\": [23]}, {\"name\": \"CLIP\", \"type\": \"CLIP\", \"links\": [52, 55]}, {\"name\": \"VAE\", \"type\": \"VAE\", \"links\": [45]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"CheckpointLoaderSimple\"}, \"widgets_values\": [\"juggernautXL_ragnarokBy.safetensors\"]}, {\"id\": 20, \"type\": \"3d8bbee1-9162-4cf9-9483-f8c9edc8656b\", \"pos\": [1010, -100], \"size\": [225, 134], \"flags\": {}, \"order\": 3, \"mode\": 0, \"inputs\": [{\"name\": \"clip\", \"type\": \"CLIP\", \"link\": 55}], \"outputs\": [{\"name\": \"CONDITIONING\", \"type\": \"CONDITIONING\", \"links\": [56]}], \"properties\": {\"proxyWidgets\": [[\"3\", \"text\"]], \"cnr_id\": \"comfy-core\", \"ver\": \"0.3.76\"}, \"widgets_values\": []}, {\"id\": 13, \"type\": \"EmptyLatentImage\", \"pos\": [840, 200], \"size\": [270, 106], \"flags\": {}, \"order\": 1, \"mode\": 0, \"inputs\": [], \"outputs\": [{\"name\": \"LATENT\", \"type\": \"LATENT\", \"links\": [48]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"EmptyLatentImage\"}, \"widgets_values\": [832, 1216, 1]}, {\"id\": 2, \"type\": \"KSampler\", \"pos\": [1420, -110], \"size\": [270, 262], \"flags\": {}, \"order\": 5, \"mode\": 0, \"inputs\": [{\"name\": \"model\", \"type\": \"MODEL\", \"link\": 23}, {\"name\": \"positive\", \"type\": \"CONDITIONING\", \"link\": 42}, {\"name\": \"negative\", \"type\": \"CONDITIONING\", \"link\": 56}, {\"name\": \"latent_image\", \"type\": \"LATENT\", \"link\": 48}], \"outputs\": [{\"name\": \"LATENT\", \"type\": \"LATENT\", \"links\": [50]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.77\", \"Node name for S&R\": \"KSampler\"}, \"widgets_values\": [416947912840831, \"randomize\", 30, 3, \"dpmpp_2m_sde\", \"karras\", 1]}], \"links\": [[23, 1, 0, 2, 0, \"MODEL\"], [42, 3, 0, 2, 1, \"CONDITIONING\"], [43, 17, 0, 8, 0, \"IMAGE\"], [45, 1, 2, 17, 1, \"VAE\"], [48, 13, 0, 2, 3, \"LATENT\"], [50, 2, 0, 17, 0, \"LATENT\"], [52, 1, 1, 19, 0, \"CLIP\"], [54, 19, 0, 3, 0, \"CLIP\"], [55, 1, 1, 20, 0, \"CLIP\"], [56, 20, 0, 2, 2, \"CONDITIONING\"]], \"groups\": [], \"definitions\": {\"subgraphs\": [{\"id\": \"3d8bbee1-9162-4cf9-9483-f8c9edc8656b\", \"version\": 1, \"state\": {\"lastGroupId\": 0, \"lastNodeId\": 38, \"lastLinkId\": 60, \"lastRerouteId\": 0}, \"revision\": 0, \"config\": {}, \"name\": \"Negative Prompts\", \"inputNode\": {\"id\": -10, \"bounding\": [-340, -127, 120, 60]}, \"outputNode\": {\"id\": -20, \"bounding\": [380, -127, 128.6640625, 60]}, \"inputs\": [{\"id\": \"2a003c94-ecef-4189-94e5-639b0a704c9d\", \"name\": \"clip\", \"type\": \"CLIP\", \"linkIds\": [60], \"localized_name\": \"clip\", \"pos\": [55, 20]}], \"outputs\": [{\"id\": \"e59786bc-94b7-486b-a377-bc3db8f8eefd\", \"name\": \"CONDITIONING\", \"type\": \"CONDITIONING\", \"linkIds\": [25], \"localized_name\": \"CONDITIONING\", \"pos\": [20, 20]}], \"widgets\": [], \"nodes\": [{\"id\": 3, \"type\": \"CLIPTextEncode\", \"pos\": [-160, -220], \"size\": [480, 276], \"flags\": {}, \"order\": 0, \"mode\": 0, \"inputs\": [{\"localized_name\": \"clip\", \"name\": \"clip\", \"type\": \"CLIP\", \"link\": 60}], \"outputs\": [{\"localized_name\": \"CONDITIONING\", \"name\": \"CONDITIONING\", \"type\": \"CONDITIONING\", \"links\": [25]}], \"properties\": {\"cnr_id\": \"comfy-core\", \"ver\": \"0.3.75\", \"Node name for S&R\": \"CLIPTextEncode\"}, \"widgets_values\": [\"Text, Watermark\"]}], \"groups\": [], \"links\": [{\"id\": 60, \"origin_id\": -10, \"origin_slot\": 0, \"target_id\": 3, \"target_slot\": 0, \"type\": \"CLIP\"}, {\"id\": 25, \"origin_id\": 3, \"origin_slot\": 0, \"target_id\": -20, \"target_slot\": 0, \"type\": \"CONDITIONING\"}], \"extra\": {}}]}, \"config\": {}, \"extra\": {\"ds\": {\"scale\": 1.7715610000000017, \"offset\": [-953.444623183584, 135.70741308626853]}, \"frontendVersion\": \"1.32.10\"}, \"version\": 0.4}", "UsgromanaNSFW": "true", "UsgromanaNSFWScore": "1.0", "UsgromanaNSFWLabel": "manual", "Keywords": "NSFW", "Subject": "NSFW Content (Score: 1.00)", "Comment": "NSFW Content Detected - Score: 1.00, Label: manual", "Rating": "5", "XML:com.adobe.xmp": "<?xpacket begin=\"\" id=\"W5M0MpCehiHzreSzNTczkc9d\"?>\n<x:xmpmeta xmlns:x=\"adobe:ns:meta/\" x:xmptk=\"Adobe XMP Core\"><rdf:RDF xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\" xmlns:xmp=\"http://ns.adobe.com/xap/1.0/\" xmlns:dc=\"http://purl.org/dc/elements/1.1/\"><rdf:Description rdf:about=\"\" xmp:Rating=\"5\" /></rdf:RDF></x:xmpmeta>\n<?xpacket end=\"w\"?>"}}, "timestamp": 1765614965282}
{"sessionId": "debug-session", "runId": "post-fix", "hypothesisId": "A", "location": "nsfw_guard.py:197", "message": "PNG metadata preservation check", "data": {"preserved_keys": ["prompt", "workflow", "Rating", "XML:com.adobe.xmp", "display_name"], "skipped_keys": ["UsgromanaNSFW", "UsgromanaNSFWScore", "UsgromanaNSFWLabel", "Keywords", "Subject", "Comment"], "total_keys": 11}, "timestamp": 1765614965282}
{"sessionId": "debug-session", "runId": "post-fix", "hypothesisId": "B", "location": "nsfw_guard.py:207", "message": "PNG Windows fields before overwrite", "data": {"existing_keywords": "NSFW", "existing_subject": "NSFW Content (Score: 1.00)", "existing_comment": "NSFW Content Detected - Score: 1.00, Label: manual"}, "timestamp": 1765614965283}
{"sessionId": "debug-session", "runId": "post-fix", "hypothesisId": "A", "location": "nsfw_guard.py:220", "message": "PNG after save", "data": {"after_info_keys": ["prompt", "workflow", "Rating", "XML:com.adobe.xmp", "display_name", "UsgromanaNSFW", "UsgromanaNSFWScore", "UsgromanaNSFWLabel", "Keywords", "Subject", "Comment"]}, "timestamp": 1765614965480}
